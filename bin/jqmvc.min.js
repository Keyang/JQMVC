(function(c,b){var a="mvc";c[a]={};var d=c[a];d.ext=function(f,e,g){if(typeof f!="object"){throw ("mvc.ext first param should be entry object.")}if(typeof e!="string"){throw ("mvc.ext second param should be key as string.")}f[e]=g};d.opt=b})(window,_app_);mvc.ext(mvc,"cls",{});mvc.ext(mvc,"util",{text:{format:function(){var b=arguments;var e=b[0];var d=e;for(var c=1;c<b.length;c++){var a=c-1;d=d.replace("{"+a+"}",b[c])}return d}},copyJSON:function(e,a){var d={};if(a!=undefined){d=a}var c=e;for(var b in c){if(!mvc.util.isEmpty(c[b])){if(c[b].constructor==Object){d[b]=mvc.util.copyJSON(c[b])}else{d[b]=c[b]}}else{d[b]=c[b]}}return d},isEmpty:function(a){return a==undefined||a===""||a===null||a==={}}});mvc.ext(mvc.cls,"_log",function(){var b={};var c={log:function(d){console.log(d)}};var a={d:function(e){e=e||"";var d="DEBUG: {0}";c.log(mvc.util.text.format(d,e))},i:function(e){e=e||"";var d="INFO: {0}";c.log(mvc.util.text.format(d,e))},e:function(h,d,g){h=h||"";if(typeof h==="string"){var f="ERROR: {0}. {1}:{2}.";c.log(mvc.util.text.format(f,h,d,g))}else{throw (h)}}};return a});mvc.ext(mvc.cls,"controller",function(){var _props={curCtl:null,_ctls:{},_controller:{prop:{name:"controllerName",_action:""},ulti:{},action:{}}};var _private={ctlcls:function(key,param){var components=_props.components;var props=_props._controller.props;var ulti=_props._controller.ulti;var actions=_props._controller.action;var that={};for(var key in props){that[key]=props[key]}if(typeof(param.prop["name"])=="undefined"){throw ("Please specify a name to controllers")}else{that.name=param.prop["name"]}for(var key in actions){that[key]=__mvc.func.controllerFuncMaker(that,key,actions[key])}for(var key in ulti){that[key]=function(key,ulti,that){return function(){return ulti[key].apply(that,arguments)}}(key,ulti,that)}if(typeof(param.prop)!="undefined"){for(var key in param.prop){if(typeof(param.prop[key])!="function"){that[key]=param.prop[key]}}}if(param.ulti!=undefined){for(var key in param.ulti){that[key]=function(key,ulti,that){return function(){try{var res=ulti[key].apply(that,arguments)}catch(e){console.log("Error in ulti:"+key+" in controller:"+that.name+" Error:"+e)}return res}}(key,param.ulti,that)}}if(param.action!=undefined){for(var key in param.action){if(typeof(param.action[key])!="function"){that[key]=param.action[key]}else{that[key]=__mvc.func.controllerFuncMaker(that,key,param.action[key])}}}if(param.components!=undefined){that.com={};for(var i=0;i<param.components.length;i++){if(components[param.components[i]]!=undefined){that.com[param.components[i]]=(function(){var comName=param.components[i];var com=components[param.components[i]];if(typeof com!="function"){return com}return function(){try{return com.apply(com,arguments)}catch(e){console.log("error in component:"+comName+" Error:"+e)}}})()}else{var path=_app_.pluginPath+"P"+param.components[i]+".js";var res=$.mvc.func.loadPage(path);if(res!=""){try{eval(res)}catch(e){console.log("Parse error: "+e+" in componentn:"+param.components[i])}}if(components[param.components[i]]!=undefined){that.com[param.components[i]]=(function(){var comName=param.components[i];var com=components[param.components[i]];if(typeof com!="function"){return com}return function(){try{return com.apply(com,arguments)}catch(e){console.log("error in component:"+comName+" Error:"+e)}}})();continue}throw ("Component:"+param.components[i]+" is not defined")}}}if(param.events!=undefined){that._uievents=param.events}if(param.models!=undefined){var ms=param.models;if(ms.constructor==Array){for(var i=0;i<ms.length;i++){that[ms[i]]=$.mvc.model(ms[i])}}}if(typeof(that.name)=="undefined"){throw ("name should be specified in a controller")}if(__mvc.c[that.name]!=undefined){throw ("Controller:"+that.name+" has been defined more than once.")}__mvc.c[that.name]=that;if(that.init!=undefined){$(document).ready(that.init)}}};var _public={add:function(key,obj){var param=obj},get:function(key){if(typeof key=="undefined"){return _props.curCtl}else{if(_props._ctls[key]==undefined){mvc.log.e("Cant find controller.","Key",key)}}}};return _public});mvc.ext(mvc.cls,"ajax",function(){var a={cachedHtml:{}};var c={ajax:function(e,d){var g=e;if(d!==undefined){for(var f in d){g[f]=d[f]}}if(typeof mvc.opt.xhr!="undefined"){g.xhr=mvc.opt.xhr}return $.ajax(g)},asyncLoad:function(f,h,e){function d(i){try{h(i)}catch(j){mvc.log.e(j,"asyncLoad",f)}}if(a.cachedHtml[f]!=undefined){d(a.cachedHtml[f]);return}var g={async:true,url:f,type:"GET",dataType:"text",success:function(i){a.cachedHtml[f]=i;d(i)},error:function(k,j,i){mvc.log.e(j,"asyncLoad",f);d("")}};c.ajax(g,e)},syncLoad:function(j,f){var d=null;if(a.cachedHtml[j]!=undefined){return a.cachedHtml[j]}var k={async:false,url:j,type:"GET",dataType:"text"};try{var h=c.ajax(k,f);if(h.statusText==="error"){mvc.log.e(mvc.string.error.ajax.loadErr,"FilePath",j)}var g="";if(h.responseText){g=h.responseText;a.cachedHtml[j]=g}return g}catch(i){mvc.log.e(mvc.string.error.ajax.loadErr,"FilePath",j);return""}}};var b={syncLoad:c.syncLoad,asyncLoad:c.asyncLoad};return b});mvc.ext(mvc.cls,"event",function(c){var b={bind:function(f,e,g){return d.bind(f,e,g)},fire:function(f,h,e,g){return d.fire(f,h,e,g)},bindOnce:function(f,e,g){if(d.eventExists(f,e)){return false}else{return b.bind(f,e,g)}},unbind:function(f,e){if(e!=undefined){}}};var d={unbind:function(f,e){if(e!=undefined){delete a.events[f][e]}else{a.events[f]={}}},bind:function(f,e,g){if(a.events[f]==undefined){mvc.log.e(mvc.string.error.event.etnf,"EventType",f);return false}a.events[f][e]=g;return true},fire:function(g,i,f,h){function e(){if(a.events[g]==undefined){mvc.log.e(mvc.string.error.event.etnf,"EventType",g);return}var l=a.events[g];if(j!=undefined){var k=funcs[j];d.exec(k,i)}else{for(var j in l){var k=l[j];d.exec(k,i)}}}if(h==undefined){h=true}if(h===true){setTimeout(e,0)}else{e()}},exec:function(f,h){if(h==undefined){h=[]}if(!(h instanceof Array)){h=[h]}try{f.apply(a.scope,h)}catch(g){mvc.log.e(g,"Execute event handler",f.toString())}},eventExists:function(g,f){try{var i=a.events[g][f];if(i!=undefined){return true}return false}catch(h){mvc.log.e(h,"Event",g+"->"+f)}return false}};var a={events:{init:{},rendered:{},updated:{},displayed:{}},scope:c||{}};return b});mvc.ext(mvc.cls,"parser",function(){var b={parseHtml:function(d,e){return c.parseHtml(d,e)}};var a={startTag:"<?mvc",endTag:"?>",_basic:{__resStack:"",echo:function(d){this.__resStack+=d}}};var c={parseHtml:function(g,f){var e=-1;if(f==undefined||mvc.util.isEmpty(f)){f={}}mvc.util.copyJSON(a._basic,f);if(g==undefined){return""}var l=a.startTag;var k=a.endTag;while((e=g.indexOf(l))!=-1){f.__resStack="";var i=e+l.length+1;var h=g.indexOf(k,i);var j=g.substring(i,h);var d="";d=mvc.parseExec(j,f);if(d==undefined){d=""}d=f.__resStack+d;g=g.replace(g.substring(e,h+2),d)}return g}};return b});mvc.ext(mvc,"parseExec",function(__code__,__scope__){with(__scope__){try{return eval(__code__)}catch(e){mvc.log.e(e,"Parse MVC code:",__code__)}}});mvc.ext(mvc,"parseJSON",function(__code__){try{return eval("("+__code__+")")}catch(e){mvc.log.e(e,"Parse JSON Object:",__code__)}});mvc.ext(mvc,"string",{error:{view:{vnun:"View name should not be undefined",vnex:"Cannot set a view as current view that is not existed!"},ajax:{loadErr:"Ajax loading file error"},event:{etnf:"Event type indicated not found."}},info:{view:{ravt:"Trying to render a view that is displaying. Use update method instead.",lpf:"Load Page From:"}}});mvc.ext(mvc.cls,"uidata",function(){var b={setGlobalData:function(d){c.setGlobalData(d)},getUIDataScope:function(d){return c.getUIDataScope(d)}};var c={setGlobalData:function(d){a.globalData=d},getUIDataScope:function(g){var h=mvc.util.copyJSON(a.globalData);var i={};if(a.cachedJSON[g]!=undefined){i=a.cachedJSON[g]}else{var d=mvc.ajax.syncLoad(g,{dataType:"json"});if(d!=undefined&&d!=""){try{if(typeof d=="object"){i=d}else{try{i=mvc.parseJSON(d)}catch(f){mvc.log.e(f,"Load UI Data",g)}}a.cachedJSON[g]=i}catch(f){mvc.log.e(f,"Load UI Data",g)}}}i._global=h;return i}};var a={globalData:{},cachedJSON:{}};return b});mvc.ext(mvc.cls,"view",function(){var b={get:function(d){return c.get(d)},isViewExisted:function(d){return c.isViewExisted(d)},display:function(d){return c.display(d)},loadRender:function(d){return c.loadRender(d)},reset:function(d){return c.reset(d)},back:function(){return c.back()}};var a={curView:null,_views:{},viewRendering:null,history:new mvc.cls.history()};var c={back:function(){var d=a.history.back();c.display(d,false)},reset:function(d){a._views[d]=new mvc.cls._view(d)},loadRender:function(e){if(c.isViewExisted(e)===false){return}mvc.log.i("Current Loading View:"+e);var d=a.viewRendering=c.get(e);d.load(function(){mvc.log.i("Intended Rendering View:"+d.getName());if(a.viewRendering.getName()==d.getName()){d.render()}else{var f="View Render Interrupted for:"+d.getName();mvc.log.i(f)}})},get:function(d){if(typeof d=="undefined"){return a.curView}if(a._views[d]!=undefined){return a._views[d]}else{var e=new mvc.cls._view(d);a._views[d]=e;return e}},isViewExisted:function(d){if(typeof d=="undefined"){mvc.log.e(mvc.string.error.view.vnun,"mvc.view.isViewExisted with parameter:",d);return false}if(a._views[d]!=undefined){return true}else{return false}},display:function(g,f){if(!b.isViewExisted(g)){mvc.log.e(mvc.string.error.view.vnex,"Display View",g);return}try{var d=b.get(g);a.curView=d;var h=mvc.opt.interfaces.goForwPage;if(f===false){h=mvc.opt.interfaces.goBackPage}d.display(h)}catch(i){mvc.log.e(i,"Display View",g)}}};return b});mvc.ext(mvc.cls,"_view",function(c){var b={bind:function(f,e,g){},bindOnce:function(f,e,g){},fire:function(f,g,e){},setOptions:function(f){for(var e in f){a[e]=f[e]}},display:function(f){try{f(a.name);a.event.fire("displayed")}catch(g){mvc.log.e(g,"Display View",a.name)}},load:function(e){d.loadView(function(){a.event.fire("updated");var f=mvc.view.get();if(f!=null){if(f.getName()===a.name){b.page().show()}}if(e!=undefined){e()}})},render:function(){$(mvc.opt.appContainer).find("#"+b.getName()).remove();$(mvc.opt.appContainer).append(a.htmlCode);mvc.view.display(a.name)},getName:function(){return a.name},resetParam:function(){a.param={}},setParam:function(e,f){a.param[e]=f},getParam:function(e){return a.param[e]},page:function(e){if(typeof e=="undefined"){return $("#"+a.name)}else{return $("#"+a.name).find(e)}},callback:function(f,e){if(typeof(e)=="undefined"){e=this}return function(){f.apply(e,arguments)}},viewer:function(){return $.mvc.curViewer}};var a={name:c,param:{},isRendered:false,eventObj:{},initOnce:false,layout:"default",uidataPath:null,htmlPagePath:null,uidata:null,event:new mvc.cls.event(),wrapperTag:"div",htmlCode:""};var d={init:function(){a.uidata=mvc.uidata.getUIDataScope(d.getUIDataPath());mvc.util.copyJSON(a.event,b)},getUIDataPath:function(){if(a.uidataPath==null){return mvc.opt.uidataPath+"/"+a.name+".json"}else{return a.uidataPath}},getHtmlPagePath:function(){if(a.htmlPagePath==null){return mvc.opt.pagePath+"/"+a.name+".html"}else{return a.htmlPagePath}},loadView:function(j){var i=d.getHtmlPagePath();var f=a.name;var h=mvc.opt.layoutPath+"/"+a.layout+".html";if(a.initOnce===true&&$("#"+f).length>0){try{j()}catch(g){mvc.log.e(g,"loadView",i)}}mvc.log.i(mvc.string.info.view.lpf+i);mvc.ajax.asyncLoad(i,function(e){var k=mvc.util.copyJSON(a.uidata);var m=mvc.util.copyJSON(a.param,k);var l=mvc.parser.parseHtml(e,m);m.__content__=l;mvc.ajax.asyncLoad(h,function(o){if(o==""){o="<?mvc __content__?>"}var n=mvc.parser.parseHtml(o,m);var r={html:n};a.event.fire("init",r,undefined,false);var q=mvc.util.text.format("<{2} id='{0}' style='display:none'>{1}</{3}>",f,r.html,a.wrapperTag,a.wrapperTag);a.htmlCode=q;try{j()}catch(p){mvc.log.e(p,"loadView",i)}})})}};d.init();return b});mvc.ext(mvc.cls,"history",function(){var b={push:function(d){return c.push(d)},clear:function(){return c.clear()},back:function(d){return c.back(d)}};var a={stack:[],};var c={push:function(d){if(d&&d!=null){a.stack.push(d)}},clear:function(d){a.stack=[]},pop:function(){return a.stack.pop()},back:function(d){var e="";if(d===undefined){e=c.pop();while(a.stack.length>0&&(typeof(e)=="undefined"||mvc.util.isEmpty(e)||$("#"+e).length==0)){e=c.pop()}}else{while(a.stack.length>0&&d!=e){e=c.pop()}if(e!=d){e=d}}if(e!=undefined&&e!=null){return e}}};return b});mvc.ext(mvc,"log",new mvc.cls._log());mvc.ext(mvc,"ajax",new mvc.cls.ajax());mvc.ext(mvc,"parser",new mvc.cls.parser());mvc.ext(mvc,"uidata",new mvc.cls.uidata());mvc.ext(mvc,"controller",new mvc.cls.controller());mvc.ext(mvc,"view",new mvc.cls.view());