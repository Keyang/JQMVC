(function(c,b){var a="mvc";c[a]={};var d=c[a];d.ext=function(f,e,g){if(typeof f!="object"){throw ("mvc.ext first param should be entry object.")}if(typeof e!="string"){throw ("mvc.ext second param should be key as string.")}if(f[e]!=undefined){mvc.log.i("Overwritten extention detected.")}f[e]=g};d.opt=b})(window,_app_);mvc.ext(mvc,"cls",{});mvc.ext(mvc,"$",function(a){if(a!=undefined){return $(mvc.opt.appContainer).find(a)}else{return $(mvc.opt.appContainer)}});mvc.ext(mvc,"util",{text:{format:function(){var b=arguments;var e=b[0];var d=e;for(var c=1;c<b.length;c++){var a=c-1;d=d.replace("{"+a+"}",b[c])}return d}},copyJSON:function(f,a,c){var e={};if(a!=undefined){e=a}var d=f;for(var b in d){if(c===false){if(e[b]!=undefined){continue}}if(!mvc.util.isEmpty(d[b])){if(d[b].constructor==Object){e[b]=mvc.util.copyJSON(d[b])}else{e[b]=d[b]}}else{e[b]=d[b]}}return e},isEmpty:function(a){return a==undefined||a===""||a===null||a==={}}});mvc.ext(mvc.cls,"_log",function(){var b={};var c={log:function(d){console.log(d)}};var a={d:function(e){e=e||"";var d="DEBUG: {0}";c.log(mvc.util.text.format(d,e))},i:function(e){e=e||"";var d="INFO: {0}";c.log(mvc.util.text.format(d,e))},e:function(h,d,g){h=h||"";if(typeof h==="string"){var f="ERROR: {0}. {1}:{2}.";c.log(mvc.util.text.format(f,h,d,g))}else{throw (h)}}};return a});mvc.ext(mvc,"ctl",function(c){var b={sendMSG:function(f,e){return d.sendMSG(f,e)},postMSG:function(f,e,g){return d.postMSG(f,e,g)}};var a={_ctl:null};var d={checkMSG:function(f){var e=a._ctl;if(e[f]!=undefined){if(typeof e[f]==="function"){return true}else{mvc.log.i("Detected non-function item assigned to controller.")}}else{mvc.log.i("Refered non-defined message:"+f)}return false},sendMSG:function(g,f){var e=a._ctl;if(d.checkMSG(g)){return e[g].apply(e,f)}return},postMSG:function(g,f,h){var e=a._ctl;if(d.checkMSG(g)){setTimeout(function(){var i=e[g].apply(e,f);if(h!=undefined&&typeof h==="function"){h(i)}},0)}return},init:function(){if(!d.isCtlExisted(c)){throw ("Controller with name:"+c+" Does not exist.")}a._ctl=mvc.controllers[c]},isCtlExisted:function(e){if(mvc.controllers[e]==undefined){return false}return true}};d.init();return b});mvc.ext(mvc,"controllers",{});mvc.ext(mvc.cls,"ajax",function(){var a={cachedHtml:{}};var c={ajax:function(e,d){var g=e;if(d!==undefined){for(var f in d){g[f]=d[f]}}if(typeof mvc.opt.xhr!="undefined"){g.xhr=mvc.opt.xhr}return $.ajax(g)},asyncLoad:function(f,h,e){function d(i){try{h(i)}catch(j){mvc.log.e(j,"asyncLoad",f)}}if(a.cachedHtml[f]!=undefined){d(a.cachedHtml[f]);return}var g={async:true,url:f,type:"GET",dataType:"text",success:function(i){a.cachedHtml[f]=i;d(i)},error:function(k,j,i){mvc.log.e(j,"asyncLoad",f);d("")}};c.ajax(g,e)},syncLoad:function(j,f){var d=null;if(a.cachedHtml[j]!=undefined){return a.cachedHtml[j]}var k={async:false,url:j,type:"GET",dataType:"text"};try{var h=c.ajax(k,f);if(h.statusText==="error"){mvc.log.e(mvc.string.error.ajax.loadErr,"FilePath",j)}var g="";if(h.responseText){g=h.responseText;a.cachedHtml[j]=g}return g}catch(i){mvc.log.e(mvc.string.error.ajax.loadErr,"FilePath",j);return""}}};var b={syncLoad:c.syncLoad,asyncLoad:c.asyncLoad};return b});mvc.ext(mvc.cls,"event",function(c){var b={bind:function(g,f,h,e){return d.bind(g,f,h,e)},fire:function(f,i,e,h,g){return d.fire(f,i,e,h,g)},bindFireOnce:function(g,f,h,e){return b.bind(g,f,function(){b.unbind(g,f);return h.apply(this,arguments)},e)},unbind:function(f,e){return d.unbind(f,e)},};var d={setScope:function(e){a.scope=e},unbind:function(f,e){if(e!=undefined){delete a.events[f][e]}else{a.events[f]={}}},bind:function(g,f,h,e){if(e==undefined){e=true}if(a.events[g]==undefined){a.events[g]={}}if(a.events[g][f]!=undefined){if(e===false){return true}}a.events[g][f]=h;return true},fire:function(g,j,f,i,h){function e(){if(a.events[g]==undefined){return j}var n=a.events[g];var l=j;if(k!=undefined){var m=funcs[k];l=d.exec(m,j,h)}else{for(var k in n){var m=n[k];l=d.exec(m,l,h);if(l===undefined){l=j}}}if(l===undefined){l=j}return l}if(i==undefined){i=false}if(i===true){setTimeout(e,0)}else{return e()}},exec:function(g,i,f){if(i==undefined){i=[]}if(f==undefined){f=a.scope}if(!(i instanceof Array)){i=[i]}try{return g.apply(f,i)}catch(h){mvc.log.e(h,"Execute event handler",g.toString())}},eventExists:function(g,f){try{var i=a.events[g][f];if(i!=undefined){return true}return false}catch(h){mvc.log.e(h,"Event",g+"->"+f)}return false}};var a={events:{init:{},rendered:{},updated:{},displayed:{}},scope:c||{}};return b});mvc.ext(mvc.cls,"parser",function(){var b={parseHtml:function(d,e){return c.parseHtml(d,e)}};var a={startTag:"<?mvc",endTag:"?>",_basic:{__resStack:"",echo:function(d){this.__resStack+=d}}};var c={parseHtml:function(g,f){var e=-1;if(f==undefined||mvc.util.isEmpty(f)){f={}}mvc.util.copyJSON(a._basic,f);if(g==undefined){return""}var l=a.startTag;var k=a.endTag;while((e=g.indexOf(l))!=-1){f.__resStack="";var i=e+l.length+1;var h=g.indexOf(k,i);var j=g.substring(i,h);var d="";d=mvc.parseExec(j,f);if(d==undefined){d=""}d=f.__resStack+d;g=g.replace(g.substring(e,h+2),d)}return g}};return b});mvc.ext(mvc,"parseExec",function(__code__,__scope__){with(__scope__){try{return eval(__code__)}catch(e){mvc.log.e(e,"Parse MVC code:",__code__)}}});mvc.ext(mvc,"parseJSON",function(__code__){try{return eval("("+__code__+")")}catch(e){mvc.log.e(e,"Parse JSON Object:",__code__)}});mvc.ext(mvc,"string",{error:{view:{vnun:"View name should not be undefined",vnex:"Cannot set a view as current view that is not existed!"},ajax:{loadErr:"Ajax loading file error"},event:{etnf:"Event type indicated not found."}},info:{view:{ravt:"Trying to render a view that is displaying. Use update method instead.",lpf:"Load Page From:"}}});mvc.ext(mvc.cls,"uidata",function(){var b={setGlobalData:function(d){c.setGlobalData(d)},getUIDataScope:function(d){return c.getUIDataScope(d)}};var c={setGlobalData:function(d){a.globalData=d},getUIDataScope:function(g){var h=mvc.util.copyJSON(a.globalData);var i={};if(a.cachedJSON[g]!=undefined){i=a.cachedJSON[g]}else{var d=mvc.ajax.syncLoad(g,{dataType:"json"});if(d!=undefined&&d!=""){try{if(typeof d=="object"){i=d}else{try{i=mvc.parseJSON(d)}catch(f){mvc.log.e(f,"Load UI Data",g)}}a.cachedJSON[g]=i}catch(f){mvc.log.e(f,"Load UI Data",g)}}}i._global=h;return i}};var a={globalData:{},cachedJSON:{}};return b});mvc.ext(mvc.cls,"viewMgr",function(){var b={get:function(d){return c.get(d)},isViewExisted:function(d){return c.isViewExisted(d)},init:function(d){return c.reset(d)},back:function(){return c.back()},clearHistory:function(){return c.clearHistory()},changeName:function(e,d){return c.changeName(e,d)},preLoad:function(d,e){return c.preLoad(d,e)},preLoadAll:function(d){return c.preLoadAll(d)},setPageCls:function(d){return c.setPageCls(d)},getPageCls:function(){return c.getPageCls()},clearAll:function(){return c.clearAll()}};var a={curView:null,_views:{},history:new mvc.cls.history(),events:new mvc.cls.event(),pageCls:"page"};var c={preLoad:function(e,g){for(var f=0;f<e.length;f++){var d=e[f];if(g===false){d.loadDom()}else{(function(){var h=d;setTimeout(function(){h.loadDom()},1)})()}}},preLoadAll:function(d){c.each(function(e){if(d===false){e.loadDom()}else{setTimeout(function(){e.loadDom()},1)}})},each:function(e){for(var d in a._views){e(a._views[d])}},clearAll:function(){c.each(function(d){d.remove()});c.clearHistory();a._views={};a.curView=null},getPageCls:function(){return a.pageCls},clearHistory:function(){a.history.clear()},init:function(){b.events=a.events;b.events.bind("displayed","_history_event",function(){var d=c.get();if(d!=null){a.history.push(d.getName())}a.curView=this})},changeName:function(f,e){var d=c.get(f);d.setOptions({name:e});a._views[e]=d;delete a._views[f]},back:function(){var d=a.history.back();if(d!=undefined){c.get(d).display(false)}return d},reset:function(d){return a._views[d]=new mvc.cls._view(d)},get:function(d){if(typeof d=="undefined"){return a.curView}if(a._views[d]!=undefined){return a._views[d]}else{var e=new mvc.cls._view(d);a._views[d]=e;return e}},isViewExisted:function(d){if(typeof d=="undefined"){mvc.log.e(mvc.string.error.view.vnun,"mvc.view.isViewExisted with parameter:",d);return false}if(a._views[d]!=undefined){return true}else{return false}}};c.init();return b});mvc.ext(mvc.cls,"_view",function(c,d){var b={show:function(){return e.show()},fire:function(g,i,f,h){return e.fire(g,i,f,h)},setOptions:function(f){return e.setOptions(f)},display:function(f){return e.display(f)},load:function(f){return e.load(f)},loadDom:function(f){return e.loadDom(f)},removeDom:function(){return e.removeDom()},getName:function(){return a.name},resetParam:function(){a.param={}},setParam:function(f,g){a.param[f]=g},getParam:function(f){return a.param[f]},$:function(f){return e.page(f)},remove:function(){return e.remove()}};var a={name:c,param:{},loadStatus:"init",eventObj:{},initOnce:false,uidataPath:null,htmlPagePath:null,uidata:null,events:new mvc.cls.event(b),wrapperTag:"div",htmlCode:"",isUIdataLoaded:false};var e={remove:function(){e.removeDom();a.loadStatus="removed";for(var f in b){b[f]=function(){}}},display:function(f){var h=e.page();if(h.length==0){e.loadDom(true)}try{if(f===false){func=mvc.opt.interfaces.goBackPage}else{func=mvc.opt.interfaces.goForwPage}func(a.name);b.fire("displayed",{},undefined,false)}catch(g){mvc.log.e(g,"Display View",a.name)}},show:function(){e.load();e.loadDom();e.display(true)},loadDom:function(f){if(f==undefined){f=false}if(a.loadStatus!="loaded"){e.removeDom();e.load(true)}if(a.loadStatus==="loaded"){if(mvc.$("#"+b.getName()).length===0||f===true){mvc.$().append(a.htmlCode);b.fire("domReady",b.$(),undefined,false)}return}else{mvc.log.e("Cannot load view properly.","view name:",b.getName())}},deferExec:function(f){if("loaded"===a.loadStatus){if(f!=undefined){f()}}else{if("beforeLoad"===a.loadStatus||"beforeParse"===a.loadStatus||"afterParse"===a.loadStatus){if(f!=undefined){b.bind("loaded","_tmpCb",function(){b.unbind("loaded","_tmpCb");f()})}}}},load:function(m){if(m===true){a.loadStatus="init";a.htmlCode=""}if("loaded"===a.loadStatus){return}if("init"!=a.loadStatus){return}var o=e.getHtmlPagePath();var n=a.name;var f=mvc.opt.layoutPath+"/"+a.layout+".html";if(a.initOnce===true&&$("#"+n).length>0){try{callback()}catch(l){mvc.log.e(l,"loadView",o)}}b.fire("beforeLoad");mvc.log.i(mvc.string.info.view.lpf+o);var h=mvc.ajax.syncLoad(o);if(!a.isUIdataLoaded){a.uidata=mvc.uidata.getUIDataScope(e.getUIDataPath())}var g=mvc.util.copyJSON(a.uidata);var k=mvc.util.copyJSON(a.param,g);a.loadStatus="loading";h=b.fire("beforeParse",h,undefined,false);var j=mvc.parser.parseHtml(h,k);a.loadStatus="parsing";j=b.fire("afterParse",j,undefined,false);var i=mvc.util.text.format("<{1} id='{0}' class='{3}'>{4}</{2}>",n,a.wrapperTag,a.wrapperTag,mvc.viewMgr.getPageCls(),j);a.htmlCode=i;a.loadStatus="loaded";b.fire("loaded",{},undefined,false)},page:function(f){if(mvc.$("#"+a.name).length==0){mvc.log.e("View DOM is not ready.","View:",b.getName());return}if(typeof f=="undefined"){return mvc.$("#"+a.name)}else{return mvc.$("#"+a.name).find(f)}},removeDom:function(){mvc.$("#"+a.name).remove()},fire:function(h,j,g,i){var f=mvc.viewMgr.events.fire(h,j,g,i,b);return a.events.fire(h,f,g,i)},setOptions:function(g){for(var f in g){e.optionInteruptter(f);a[f]=g[f]}},optionInteruptter:function(f){if("name"===f){a.isUIdataLoaded=false;e.removeDom()}if("uidataPath"===f){a.isUIdataLoaded=false}},init:function(){mvc.util.copyJSON(a.events,b,false)},getUIDataPath:function(){if(a.uidataPath==null){return mvc.opt.uidataPath+"/"+a.name+".json"}else{return a.uidataPath}},getHtmlPagePath:function(){if(a.htmlPagePath==null){return mvc.opt.pagePath+"/"+a.name+".html"}else{return a.htmlPagePath}}};e.init();return b});mvc.ext(mvc.cls,"history",function(){var b={push:function(d){return c.push(d)},clear:function(){return c.clear()},back:function(d){return c.back(d)}};var a={stack:[],};var c={push:function(d){if(d&&d!=null){a.stack.push(d)}},clear:function(d){a.stack=[]},pop:function(){return a.stack.pop()},back:function(d){var e="";if(d===undefined){e=c.pop();while(a.stack.length>0&&(typeof(e)=="undefined"||mvc.util.isEmpty(e)||$("#"+e).length==0)){e=c.pop()}}else{while(a.stack.length>0&&d!=e){e=c.pop()}if(e!=d){e=d}}if(e!=undefined&&e!=null){return e}}};return b});mvc.ext(mvc,"log",new mvc.cls._log());mvc.ext(mvc,"ajax",new mvc.cls.ajax());mvc.ext(mvc,"parser",new mvc.cls.parser());mvc.ext(mvc,"uidata",new mvc.cls.uidata());mvc.ext(mvc,"viewMgr",new mvc.cls.viewMgr());