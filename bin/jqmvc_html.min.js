/*
* JQMVC framework
* https://github.com/Keyang/JQMVC
*
* Copyright 2011-2012, Keyang Xiang
* Licensed under the MIT
*/

(function(c,b){var a="mvc";c[a]={};var d=c[a];d.ext=function(f,e,g){if(typeof f!="object"){throw ("mvc.ext first param should be entry object.")}if(typeof e!="string"){throw ("mvc.ext second param should be key as string.")}f[e]=g};d.opt=b})(window,{});mvc.ext(mvc,"cls",{});mvc.ext(mvc,"util",{text:{format:function(){var b=arguments;var e=b[0];var d=e;for(var c=1;c<b.length;c++){var a=c-1;d=d.replace("{"+a+"}",b[c])}return d}},copyJSON:function(g,a,d){if(typeof g!="object"||g===null){return g}var f={};if(a!=undefined){f=mvc.util.copyJSON(a,undefined,true)}var e=g;if(e instanceof Array){f=[];for(var c=0;c<e.length;c++){f.push(mvc.util.copyJSON(e[c]))}}else{for(var b in e){if(d===false){if(f[b]!=undefined){continue}}f[b]=mvc.util.copyJSON(e[b])}}return f},isEmpty:function(a){return a==undefined||a===""||a===null||a==={}}});mvc.ext(mvc,"Class",(function(){function g(h){if(typeof h=="function"){return true}return false}function a(){}function b(j,h){for(var i in h){j[i]=h[i]}}function e(h){var k=new Array();for(var j=0;j<h.length;j++){k.push(h[j])}return k}function f(h){var i=h.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return i.length==1&&!i[0]?[]:i}function c(){var k=null,j=e(arguments);if(g(j[0])){k=j.shift()}function h(){this.props=mvc.util.copyJSON(h.props,undefined,true);this.initialise.apply(this,arguments)}b(h,mvc.Class.Methods);h.props={};h.superclass=k;h.subclasses=[];if(k){a.prototype=k.prototype;h.prototype=new a;k.subclasses.push(h);var m=h.prototype;for(var i in m){var l=m[i];if(l===null){j[0][i]=null}else{if(typeof l==="object"&&i==="props"){if(j[0][i]===undefined){j[0][i]={}}j[0][i]=mvc.util.copyJSON(l,j[0][i],false)}}}}h.addMethods(j[0]);if(!h.prototype.initialise){h.prototype.initialise=function(){}}h.prototype.constructor=h;return h}function d(m){var j=this.superclass&&this.superclass.prototype;for(var i in m){var l=i,k=m[i];if(j&&g(k)&&f(k)[0]=="$super"){var h=k;k=(function(){var o=h;var n=l;return function(){var q=this;var r=function(){return j[n].apply(q,arguments)};var p=e(arguments)||[];p.unshift(r);o.apply(this,p)}})()}if(typeof k==="object"){if(i==="props"){this.props=k}}this.prototype[l]=k}return this}return{create:c,Methods:{addMethods:d}}})());mvc.ext(mvc,"app",{props:{readyFuncs:[]},init:function(b){mvc.opt=mvc.util.copyJSON(b,mvc.opt,true);if(mvc.opt.ready!=undefined){for(var a=0;a<this.props.readyFuncs.length;a++){var c=this.props.readyFuncs[a];mvc.opt.ready(c)}}else{for(var a=0;a<this.props.readyFuncs.length;a++){var c=this.props.readyFuncs[a];c()}}},ready:function(a){this.props.readyFuncs.push(a)}});mvc.ext(mvc.cls,"cfg",mvc.Class.create({props:{name:"undefined",checkItems:{}},initialise:function(a){this.props.name=a},check:function(c){for(var b in this.props.checkItems){var d=this.props.checkItems[b];var a=d(c);if(a===false){throw ("error happend");return false}}return"Configuration check passed."},addItem:function(a,b){if(typeof a==="string"&&typeof b==="function"){this.props.checkItems[a]=b}},removeItem:function(a){if(this.props.checkItems[a]){delete this.props.checkItems[a]}},err:function(b,a){var c=" object is required in app configuration.";if(typeof a!="undefined"){c+=a}throw (b+c)}}));mvc.cfg=new mvc.cls.cfg("cfg");mvc.ext(mvc.cls,"observer",mvc.Class.create({notify:function(){throw ("notify is not overwritten")}}));mvc.ext(mvc.cls,"subject",mvc.Class.create(mvc.cls.observer,{props:{observers:{},name:null},initialise:function(a){this.props.name=a},getName:function(){return this.props.name},unsubscribe:function(a){if(this.props.observers[a]){delete this.props.observers[a]}},subscribe:function(b,a){if(a.notify===undefined){throw ("subscribed object should be subclass of observer")}this.props.observers[b]=a},notifyAll:function(){for(var b in this.props.observers){var a=this.props.observers[b];a.notify.apply(a,arguments)}},notify:function(){}}));mvc.ext(mvc.cls,"_log",function(){var b={};var c={log:function(d){if(typeof console==="undefined"){console={}}if(console.log==="undefined"){console.log=function(){}}console.log(d)}};var a={d:function(e){e=e||"";var d="DEBUG: {0}";c.log(mvc.util.text.format(d,e))},i:function(e){e=e||"";var d="INFO: {0}";c.log(mvc.util.text.format(d,e))},e:function(h,d,g){h=h||"";if(typeof h==="string"){var f="ERROR: {0}. {1}:{2}.";c.log(mvc.util.text.format(f,h,d,g))}else{throw (h)}},w:function(e){var d="WARNNING: {0}";c.log(mvc.util.text.format(d,e))}};return a});mvc.log=new mvc.cls._log();mvc.ext(mvc,"ctl",function(c){var b={sendMSG:function(f,e){return d.sendMSG(f,e)},postMSG:function(f,e,g){return d.postMSG(f,e,g)},checkCtl:function(e){return d.checkCtl(e)}};var a={_ctl:null};var d={checkCtl:function(e){if(!d.isCtlExisted(c)){return false}if(e){if(!mvc.controllers[c][e]){return false}}return true},checkMSG:function(f){var e=a._ctl;if(e[f]!=undefined){if(typeof e[f]==="function"){return true}else{mvc.log.i("Detected non-function item assigned to controller.")}}else{mvc.log.i("Refered non-defined message:"+f)}return false},sendMSG:function(g,f){if(!d.isCtlExisted(c)){throw ("Controller with name:"+c+" Does not exist.")}var e=a._ctl;if(d.checkMSG(g)){if(f===undefined||f===null){f=[]}if(!(f instanceof Array)){f=[f]}return e[g].apply(e,f)}return},postMSG:function(g,f,h){if(!d.isCtlExisted(c)){throw ("Controller with name:"+c+" Does not exist.")}var e=a._ctl;if(d.checkMSG(g)){setTimeout(function(){if(f===undefined||f===null){f=[]}if(!(f instanceof Array)){f=[f]}var i=e[g].apply(e,f);if(h!=undefined&&typeof h==="function"){h(i)}},0)}return},init:function(){a._ctl=mvc.controllers[c]},isCtlExisted:function(e){if(mvc.controllers[e]==undefined){return false}return true}};d.init();return b});mvc.ext(mvc,"controllers",{});mvc.ext(mvc,"regCtl",function(a,b){if(typeof b!="object"){mvc.log.e("Controller should be a JSON object!");return false}mvc.ext(mvc.controllers,a,b);return true});mvc.ext(mvc.cls,"event",function(c){var b={bind:function(g,f,h,e){return d.bind(g,f,h,e)},fire:function(f,i,e,h,g){return d.fire(f,i,e,h,g)},bindFireOnce:function(g,f,h,e){return b.bind(g,f,function(){b.unbind(g,f);return h.apply(this,arguments)},e)},unbind:function(f,e){return d.unbind(f,e)}};var d={setScope:function(e){a.scope=e},unbind:function(f,e){if(e!=undefined){delete a.events[f][e]}else{a.events[f]={}}},bind:function(g,f,h,e){if(e==undefined){e=true}if(a.events[g]==undefined){a.events[g]={}}if(a.events[g][f]!=undefined){if(e===false){return true}}a.events[g][f]=h;return true},fire:function(g,j,f,i,h){function e(){if(a.events[g]==undefined){return j}var n=a.events[g];var l=j;if(k!=undefined){var m=funcs[k];l=d.exec(m,j,h)}else{for(var k in n){var m=n[k];l=d.exec(m,l,h);if(l===undefined){l=j}}}if(l===undefined){l=j}return l}if(i==undefined){i=false}if(i===true){setTimeout(e,0)}else{return e()}},exec:function(g,i,f){if(i==undefined){i=[]}if(f==undefined){f=a.scope}if(!(i instanceof Array)){i=[i]}try{return g.apply(f,i)}catch(h){mvc.log.e(h,"Execute event handler",g.toString())}},eventExists:function(g,f){try{var i=a.events[g][f];if(i!=undefined){return true}return false}catch(h){mvc.log.e(h,"Event",g+"->"+f)}return false}};var a={events:{init:{},rendered:{},updated:{},displayed:{}},scope:c||{}};return b});mvc.ext(mvc.cls,"model",mvc.Class.create(mvc.cls.subject,{props:{name:null,data:null,sorter:null,filter:null,proxy:null,_data:null,autoNotify:false,autoLoad:false},events:null,subscribe:function($super,a){var b=a.getName();$super(b,a)},initialise:function(b){if(!b.name){throw ("Model name should be specified")}this.events=new mvc.cls.event(this);for(var a in b){if(a==="data"){this.props._data=b[a];continue}this.props[a]=b[a]}if(this.props._data){this.reset();this.arrangeData()}if(b.methods!=undefined){for(var a in b.methods){if(this[a]!=undefined){continue}this[a]=b.methods[a]}}if(this.props.autoLoad===true){this.load()}},setProxy:function(a){this.props.proxy=a},setFilter:function(a){if(a==undefined||a==null){a=null}this.props.filter=a;this.reset();this.arrangeData()},setSorter:function(a){if(a==undefined||a==null){a=null}this.props.sorter=a;this.reset();this.arrangeData()},reset:function(){this.props.data={};this.props.data=mvc.util.copyJSON(this.props._data,undefined,true)},arrangeData:function(){if(this.props.filter===null&&this.props.sorter===null){return true}if(this.props.data instanceof Array){if(this.props.filter){var c=[];for(var b=0;b<this.props.data.length;b++){var d=this.props.data[b];var a=this.props.filter(d);if(a!=false){c.push(d)}}this.props.data=c}if(this.props.sorter){this.props.data=this.props.data.sort(this.props.sorter)}}},load:function(b,c){if(this.props.proxy){var a=this;this.exec("load",b,function(d,e){a.props._data=e;a.reset();a.arrangeData();if(c){c(d,a.getData())}})}else{mvc.log.e("Proxy is not setup in model:"+this.props.name)}},save:function(b,c){if(this.props.proxy){var a=this;this.exec("save",b,function(e,d){a.props._data=d;a.reset();a.arrangeData();if(c){c(e,a.getData())}})}else{mvc.log.e("Proxy is not setup in model:"+this.props.name)}},exec:function(b,c,d){var a=this;if(this.props.proxy){var a=this;a.events.fire("before"+b);this.props.proxy.exec(b,c,function(f,e){if(!f){e=a.events.fire("after"+b,e)}d(f,e);if(a.props.autoNotify===true){a.notifyAll()}})}else{mvc.log.e("Proxy is not setup in model:"+this.props.name)}},getData:function(){return this.props.data},getRawData:function(){return this.props._data}}));mvc.ext(mvc,"models",{});mvc.ext(mvc,"modelMgr",{regModel:function(a){if(!a.name){throw ("Model name should be specified")}mvc.ext(mvc.models,a.name,new mvc.cls.model(a));return mvc.models[a.name]},get:function(a){return mvc.models[a]}});mvc.regModel=mvc.modelMgr.regModel;mvc.ext(mvc.cls,"proxy",mvc.Class.create(mvc.cls.observer,{events:null,initialise:function(){this.events=new mvc.cls.event(this)},exec:function(b,c,d){var a=this;if(this[b]===undefined){throw ("command:"+b+" is not implemented in proxy.")}a.events.fire("before"+b);this[b](c,function(g,e){if(!g){var f=a.events.fire("after"+b,e)}d(g,f)})}}));mvc.ext(mvc,"proxy",{});mvc.ext(mvc.proxy,"simpleData",mvc.Class.create(mvc.cls.proxy,{props:{data:null},initialise:function($super,a){this.props.data=a;$super()},load:function(a,b){if(b){b(null,this.props.data)}},save:function(a,b){this.props.data=a;if(b){b(null,this.props.data)}}}));mvc.ext(mvc,"string",{error:{view:{vnun:"View name should not be undefined",vnex:"Cannot set a view as current view that is not existed!"},ajax:{loadErr:"Ajax loading file error"},event:{etnf:"Event type indicated not found."}},info:{view:{ravt:"Trying to render a view that is displaying. Use update method instead.",lpf:"Load Page From:"}}});mvc.ext(mvc.cls,"history",function(){var b={push:function(d){return c.push(d)},clear:function(){return c.clear()},back:function(d){return c.back(d)}};var a={stack:[]};var c={push:function(d){if(d&&d!=null){a.stack.push(d)}},clear:function(d){a.stack=[]},pop:function(){return a.stack.pop()},back:function(d){var e="";if(d===undefined){e=c.pop();while(a.stack.length>0&&(typeof(e)=="undefined"||mvc.util.isEmpty(e)||$("#"+e).length==0)){e=c.pop()}}else{while(a.stack.length>0&&d!=e){e=c.pop()}if(e!=d){e=d}}if(e!=undefined&&e!=null){return e}}};return b});mvc.ext(mvc.cls,"absview",mvc.Class.create(mvc.cls.observer,{viewMgr:null,name:"undefined",op_buf:"",events:null,model:null,bindModel:function(a){if(this.model){this.model.unsubscribe(this.getName())}this.model=a;this.model.subscribe(this)},initialise:function(a,b){this.name=a;this.viewMgr=b;this.events=new mvc.cls.event(this)},echo:function(a){this.op_buf+=a},show:function(){throw ("Show method should be overwritten.")},update:function(){throw ("update method should be overwritten.")},fire:function(c,e,b,d){var a;if(this.viewMgr&&this.viewMgr!=null){a=this.viewMgr.events.fire(c,e,b,d,this)}return this.events.fire(c,a,b,d)},getName:function(){return this.name},remove:function(){for(var a in this){if(typeof this[a]=="function"){this[a]=function(){}}else{this[a]=null}}},display:function(){this.fire("displayed",[this,this.viewMgr],undefined,false);return this.op_buf},notify:function(){this.update()}}));mvc.ext(mvc.cls,"absViewMgr",mvc.Class.create({props:{viewCls:null,curView:null,_views:{}},historyStack:new mvc.cls.history(),initialise:function(a){this.events=new mvc.cls.event();if(a&&typeof a==="object"){for(var b in a){this.props[b]=a[b]}}this.events.bind("displayed","_history_event",function(d,e){var c=e.get();if(c!=null){e.historyStack.push(c.getName())}e.props.curView=d})},get:function(a){if(typeof a=="undefined"){return this.props.curView}if(this.props._views[a]!=undefined){return this.props._views[a]}else{var b=new this.props.viewCls(a);this.props._views[a]=b;return b}},each:function(b){for(var a in this.props._views){b(this.props._views[a])}},isViewExisted:function(a){if(typeof a=="undefined"){mvc.log.e(mvc.string.error.view.vnun,"mvc.view.isViewExisted with parameter:",a);return false}if(this.props._views[a]!=undefined){return true}else{return false}},init:function(a){return this.props._views[a]=new this.props.viewCls(a)},clearHistory:function(){return this.historyStack.clear()},clearAll:function(){this.each(function(a){a.remove()});this.clearHistory();this.props._views={};this.props.curView=null}}));mvc.ext(mvc,"html",{});mvc.ext(mvc,"$",function(a){if(a!=undefined){return $(mvc.opt.appContainer).find(a)}else{return $(mvc.opt.appContainer)}});mvc.cfg.addItem("html_init",function(a){if(a.appContainer==undefined){mvc.cfg.err("appContainer");return false}});mvc.app.ready(function(){mvc.cfg.check(mvc.opt)});if($.browser.msie===true){if(typeof console==="undefined"){console={};console.log=function(a){}}}mvc.app.init({ajax:{},appContainer:"#pages",elementPath:"app/views/elements",viewPath:"app/views",onStart:{controller:"nav",method:"home"},showNextPage:function(a){var b=$("#"+a);var c=$(".currentPage");if(c.length>0){c.removeClass("currentPage")}b.addClass("currentPage")},showLastPage:function(a){var b=$("#"+a);var c=$(".currentPage");if(c.length>0){c.removeClass("currentPage")}b.addClass("currentPage")},ready:function(a){$(document).ready(a)}});mvc.ext(mvc.cls,"dom_ajax",function(){var a={cachedHtml:{},cfg_ajax:null};var c={init:function(){mvc.cfg.addItem("html.ajax",function(d){if(d.ajax===undefined){mvc.cfg.err("ajax");return false}a.cfg_ajax=d.ajax})},ajax:function(e,d){var g=e;if(a.cfg_ajax!=null){for(var f in a.cfg_ajax){g[f]=a.cfg_ajax[f]}}if(d!==undefined){for(var f in d){g[f]=d[f]}}return $.ajax(g)},asyncLoad:function(f,h,e){function d(i){try{h(i)}catch(j){mvc.log.e(j,"asyncLoad",f)}}if(a.cachedHtml[f]!=undefined){d(a.cachedHtml[f]);return}var g={async:true,url:f,type:"GET",dataType:"text",success:function(i){a.cachedHtml[f]=i;d(i)},error:function(k,j,i){mvc.log.e(j,"asyncLoad",f);d("")}};c.ajax(g,e)},syncLoad:function(j,f){var d=null;if(a.cachedHtml[j]!=undefined){return a.cachedHtml[j]}var k={async:false,url:j,type:"GET",dataType:"text"};try{var h=c.ajax(k,f);if(h.statusText==="error"){mvc.log.e(mvc.string.error.ajax.loadErr,"FilePath",j)}var g="";if(h.responseText){g=h.responseText;a.cachedHtml[j]=g}return g}catch(i){mvc.log.e(mvc.string.error.ajax.loadErr,"FilePath",j);return""}}};c.init();var b={syncLoad:c.syncLoad,asyncLoad:c.asyncLoad};return b});mvc.app.ready(function(){mvc.ext(mvc.html,"ajax",new mvc.cls.dom_ajax())});mvc.ext(mvc.html,"view_dom",mvc.Class.create(mvc.cls.absview,{uidata:{},wrapperTag:"div",htmlPagePath:null,loadStatus:"init",initialise:function($super,a){$super(a,mvc.html.viewMgr)},update:function(a){var c=this.fire("beforeUpdate",this.model.getData(),undefined,false);if(!c){c=this.model.getData()}this.uidata=c;this.loadDom(true);var d=this.viewMgr.get();if(d){var b=this.viewMgr.get().getName();if(b===this.getName()){this.display()}}},show:function(){this.load();this.loadDom();this.display(true)},display:function($super,a){var c=this.$();if(c.length==0){this.loadDom(true)}try{if(a===true){func=mvc.opt.showNextPage}else{func=mvc.opt.showLastPage}func(this.getName());return $super()}catch(b){mvc.log.e(b,"Display View",this.getName())}},load:function(c){if(c===true){this.loadStatus="init";this.op_buf=""}if("loaded"===this.loadStatus){return}if("init"!=this.loadStatus){return}var g="";if(this.htmlPagePath==null){g=mvc.opt.viewPath+"/"+this.getName()+".html"}else{g=this.htmlPagePath}var b=this.getName();this.fire("beforeLoad");mvc.log.i(mvc.string.info.view.lpf+g);var a=mvc.html.ajax.syncLoad(g);var d={};if(this.model){d=this.model.getData()}d=mvc.util.copyJSON(this.uidata,d);var h=d;this.loadStatus="loading";a=this.fire("beforeParse",a,undefined,false);var e=mvc.html.parser.parseHtml(a,h);this.loadStatus="parsing";e=this.fire("afterParse",e,undefined,false);if(this.op_buf!=null&&this.op_buf!=""){e=this.op_buf+e}var f=mvc.util.text.format("<{1} id='{0}' class='{3}'>{4}</{2}>",b,this.wrapperTag,this.wrapperTag,this.viewMgr.getPageCls(),e);this.op_buf=f;this.loadStatus="loaded";this.fire("loaded",{},undefined,false)},loadDom:function(a){if(a==undefined){a=false}if(this.loadStatus!="loaded"){this.removeDom();this.load(true)}if(this.loadStatus==="loaded"){if(mvc.$("#"+this.getName()).length===0||a===true){if(a){this.removeDom()}mvc.$().append(this.op_buf);this.fire("domReady",this.$(),undefined,false)}return}else{mvc.log.e("Cannot load view properly.","view name:",this.getName())}},removeDom:function(){mvc.$("#"+this.name).remove()},$:function(a){if(typeof a!="undefined"){return mvc.$("#"+this.name).find(a)}return mvc.$("#"+this.name)},remove:function($super){this.removeDom();$super()},setDomEvent:function(){var b=this;var a=arguments;function c(){var f=null;if(a.length===0){return}else{for(var e=0;e<a.length;e++){f=a[e];for(var d in f){for(var g in f[d]){b.$(d).unbind(g);b.$(d).bind(g,f[d][g])}}}}}if(this.$().length===0){this.events.bind("domReady","_setDomEvents",function(){this.events.unbind("domReady","_setDomEvents");c()})}else{c()}},setUIData:function(a){this.uidata=a}}));mvc.cfg.addItem("html.domview",function(a){if(a.showNextPage==undefined){mvc.cfg.err("showNextPage");return false}if(a.showLastPage==undefined){mvc.cfg.err("showLastPage");return false}if(a.viewPath==undefined){mvc.cfg.err("viewPath");return false}});mvc.ext(mvc.html,"_domViewMgr",mvc.Class.create(mvc.cls.absViewMgr,new (function(){var b={back:function(){var d=this.historyStack.back();if(d!=undefined){this.get(d).display(false)}return d},preLoad:function(e,f,d){return c.preLoad(e,f,d)},preLoadAll:function(f,d){var g=0;for(var e in a._views){g++}this.each(function(h){if(f===false){h.loadDom()}else{setTimeout(function(){h.loadDom();g--;if(g===0){if(d&&typeof d==="function"){d()}}},1)}})},setPageCls:function(d){return c.setPageCls(d)},getPageCls:function(){return c.getPageCls()},initialise:function($super){this.props.viewCls=mvc.html.view_dom;$super(a)}};var a={pageCls:"page"};var c={preLoad:function(f,h,d){var j=f.length;for(var g=0;g<f.length;g++){var e=f[g];if(h===false){e.loadDom()}else{(function(){var i=e;setTimeout(function(){i.loadDom();j--;if(j===0){if(d&&typeof d==="function"){d()}}},1)})()}}},getPageCls:function(){return a.pageCls},setPageCls:function(d){a.pageCl=d;return d}};return b})()));mvc.app.ready(function(){mvc.html.viewMgr=new mvc.html._domViewMgr();mvc.viewMgr=mvc.html.viewMgr;mvc.view=function(){return mvc.viewMgr.get.apply(mvc.viewMgr,arguments)}});mvc.ext(mvc.cls,"html_js_parser",function(){var b={parseHtml:function(d,e){return c.parseHtml(d,e)},addScopeItem:function(d,e){if(d&&e){a._basic[d]=e}},removeScopeItem:function(d){if(d&&a._basic[d]){delete a._basic[d]}}};var a={startTag:"<?mvc",endTag:"?>",_basic:{__resStack:"",echo:function(d){this.__resStack+=d}}};var c={init:function(){if(mvc.opt.injectTag){if(mvc.opt.injectTag.startTag){a.startTag=mvc.opt.injectTag.startTag}if(mvc.opt.injectTag.endTag){a.endTag=mvc.opt.injectTag.endTag}}},parseHtml:function(g,f){var e=-1;if(f==undefined||mvc.util.isEmpty(f)){f={}}f=mvc.util.copyJSON(a._basic,f);if(g==undefined){return""}var l=a.startTag;var k=a.endTag;while((e=g.indexOf(l))!=-1){f.__resStack="";var i=e+l.length+1;var h=g.indexOf(k,i);var j=g.substring(i,h);var d="";d=mvc.html.parseExec(j,f);if(d==undefined){d=""}d=f.__resStack+d;g=g.replace(g.substring(e,h+k.length),d)}return g}};c.init();return b});mvc.ext(mvc.html,"parseExec",function(__code__,__scope__){with(__scope__){try{return eval(__code__)}catch(e){mvc.log.e(e,"Parse MVC code:",__code__)}}});mvc.ext(mvc.html,"parseJSON",function(__code__){try{return eval("("+__code__+")")}catch(e){mvc.log.e(e,"Parse JSON Object:",__code__)}});mvc.app.ready(function(){mvc.ext(mvc.html,"parser",new mvc.cls.html_js_parser())});mvc.ext(mvc.html,"element",function(){try{if(mvc.html.parser==undefined){throw ("MVC HTML parser is not ready")}}catch(b){mvc.log.e(b)}function a(c,f){if(f==undefined){f={}}var e=mvc.opt.elementPath+"/"+c+".html";var d=mvc.html.ajax.syncLoad(e);d=mvc.html.parser.parseHtml(d,f);return d}mvc.html.parser.removeScopeItem("element");mvc.html.parser.addScopeItem("element",a)});mvc.app.ready(function(){mvc.html.element()});mvc.cfg.addItem("html_element",function(a){if(a.elementPath==undefined){mvc.cfg.err("elementPath");return false}});mvc.cfg.addItem("html_startup_action",function(a){if(a.onStart===undefined){mvc.err("onStart");return false}});mvc.ext(mvc.cls,"staticLink",function(hrefStr){var conStr=mvc.opt.onStart.controller;var actStr=mvc.opt.onStart.method;var params=[];var s1=hrefStr.indexOf("_ctl=");if(s1>0){var subStr=hrefStr.substr(s1+5);var e1=subStr.indexOf("&");if(e1==-1){conStr=subStr;e1=subStr.indexOf("#");if(e1!=-1){conStr=subStr.substring(0,e1)}}else{conStr=subStr.substring(0,e1)}var s2=hrefStr.indexOf("_act=");if(s2>0){subStr=hrefStr.substr(s2+5);var e2=subStr.indexOf("&");if(e2==-1){actStr=subStr;e2=subStr.indexOf("#");if(e2!=-1){actStr=subStr.substring(0,e2)}}else{actStr=subStr.substring(0,e2)}var s3=hrefStr.indexOf("_param=");if(s3>0){subStr=hrefStr.substr(s3+7);var e2=subStr.indexOf("&");var paramStr="[]";if(e2==-1){paramStr=subStr;e2=subStr.indexOf("#");if(e2!=-1){paramStr=subStr.substring(0,e2)}}else{paramStr=subStr.substring(0,e2)}params=eval("("+paramStr+")")}}else{mvc.log.i("_act is not found in static link")}}if(typeof mvc.opt.launch==="function"){mvc.opt.launch({controller:conStr,method:actStr,param:params});return}else{if(mvc.ctl(conStr).checkCtl(actStr)){mvc.ctl(conStr).sendMSG(actStr,[])}else{mvc.log.i("default launch method or controller or method is not found.")}}return});mvc.app.ready(function(){var a=window.location.href;return mvc.cls.staticLink(a)});mvc.ext(mvc.proxy,"ajax",mvc.Class.create(mvc.cls.proxy,{props:{url:"",cfg_ajax:null,dataType:"text"},load:function(e,f){var a=this.props.url;if(e!=undefined&&typeof e==="object"){a+="?";for(var b in e){a+=b+"="+e[b]+"&"}}var c=this;var d={async:true,url:a,type:"GET",dataType:this.props.dataType,success:function(g){if(f){f(null,g)}},error:function(i,h,g){mvc.log.e(h,"asyncLoad",c.props.url);if(f){f(h,{})}}};if(this.props.cfg_ajax!=null){for(var b in this.props.cfg_ajax){d[b]=this.props.cfg_ajax[b]}}$.ajax(d)},initialise:function($super,b,a){if(b==undefined){throw ("Ajax proxy needs url as param of constructor.")}this.props.url=b;this.props.cfg_ajax=mvc.opt.ajax;this.props.dataType=a;$super()}}));