(function(c,b){var a="mvc";c[a]={};var d=c[a];d.ext=function(f,e,g){if(typeof f!="object"){throw ("mvc.ext first param should be entry object.")}if(typeof e!="string"){throw ("mvc.ext second param should be key as string.")}if(f[e]!=undefined){mvc.log.i("Overwritten extention detected.")}f[e]=g};d.opt=b})(window,_app_);mvc.ext(mvc,"cls",{});mvc.ext(mvc,"util",{text:{format:function(){var b=arguments;var e=b[0];var d=e;for(var c=1;c<b.length;c++){var a=c-1;d=d.replace("{"+a+"}",b[c])}return d}},copyJSON:function(f,a,c){var e={};if(a!=undefined){e=a}var d=f;for(var b in d){if(c===false){if(e[b]!=undefined){continue}}if(!mvc.util.isEmpty(d[b])){if(d[b].constructor==Object){e[b]=mvc.util.copyJSON(d[b])}else{e[b]=d[b]}}else{e[b]=d[b]}}return e},isEmpty:function(a){return a==undefined||a===""||a===null||a==={}}});mvc.ext(mvc,"Class",(function(){function g(h){if(typeof h=="function"){return true}return false}function a(){}function b(j,h){for(var i in h){j[i]=h[i]}}function e(h){var k=new Array();for(var j=0;j<h.length;j++){k.push(h[j])}return k}function f(h){var i=h.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return i.length==1&&!i[0]?[]:i}function c(){var j=null,i=e(arguments);if(g(i[0])){j=i.shift()}function h(){this.initialise.apply(this,arguments)}b(h,mvc.Class.Methods);h.superclass=j;h.subclasses=[];if(j){a.prototype=j.prototype;h.prototype=new a;j.subclasses.push(h)}h.addMethods(i[0]);if(!h.prototype.initialise){h.prototype.initialise=function(){}}h.prototype.constructor=h;return h}function d(m){var j=this.superclass&&this.superclass.prototype;for(var i in m){var l=i,k=m[i];if(j&&g(k)&&f(k)[0]=="$super"){var h=k;k=(function(){var o=h;var n=l;return function(){var q=this;var r=function(){return j[n].apply(q,arguments)};var p=e(arguments)||[];p.unshift(r);o.apply(this,p)}})()}this.prototype[l]=k}return this}return{create:c,Methods:{addMethods:d}}})());mvc.ext(mvc.cls,"_log",function(){var b={};var c={log:function(d){console.log(d)}};var a={d:function(e){e=e||"";var d="DEBUG: {0}";c.log(mvc.util.text.format(d,e))},i:function(e){e=e||"";var d="INFO: {0}";c.log(mvc.util.text.format(d,e))},e:function(h,d,g){h=h||"";if(typeof h==="string"){var f="ERROR: {0}. {1}:{2}.";c.log(mvc.util.text.format(f,h,d,g))}else{throw (h)}},w:function(e){var d="WARNNING: {0}";c.log(mvc.util.text.format(d,e))}};return a});mvc.log=new mvc.cls._log();mvc.ext(mvc,"ctl",function(c){var b={sendMSG:function(f,e){return d.sendMSG(f,e)},postMSG:function(f,e,g){return d.postMSG(f,e,g)}};var a={_ctl:null};var d={checkMSG:function(f){var e=a._ctl;if(e[f]!=undefined){if(typeof e[f]==="function"){return true}else{mvc.log.i("Detected non-function item assigned to controller.")}}else{mvc.log.i("Refered non-defined message:"+f)}return false},sendMSG:function(g,f){var e=a._ctl;if(d.checkMSG(g)){return e[g].apply(e,f)}return},postMSG:function(g,f,h){var e=a._ctl;if(d.checkMSG(g)){setTimeout(function(){var i=e[g].apply(e,f);if(h!=undefined&&typeof h==="function"){h(i)}},0)}return},init:function(){if(!d.isCtlExisted(c)){throw ("Controller with name:"+c+" Does not exist.")}a._ctl=mvc.controllers[c]},isCtlExisted:function(e){if(mvc.controllers[e]==undefined){return false}return true}};d.init();return b});mvc.ext(mvc,"controllers",{});mvc.ext(mvc.cls,"event",function(c){var b={bind:function(g,f,h,e){return d.bind(g,f,h,e)},fire:function(f,i,e,h,g){return d.fire(f,i,e,h,g)},bindFireOnce:function(g,f,h,e){return b.bind(g,f,function(){b.unbind(g,f);return h.apply(this,arguments)},e)},unbind:function(f,e){return d.unbind(f,e)},};var d={setScope:function(e){a.scope=e},unbind:function(f,e){if(e!=undefined){delete a.events[f][e]}else{a.events[f]={}}},bind:function(g,f,h,e){if(e==undefined){e=true}if(a.events[g]==undefined){a.events[g]={}}if(a.events[g][f]!=undefined){if(e===false){return true}}a.events[g][f]=h;return true},fire:function(g,j,f,i,h){function e(){if(a.events[g]==undefined){return j}var n=a.events[g];var l=j;if(k!=undefined){var m=funcs[k];l=d.exec(m,j,h)}else{for(var k in n){var m=n[k];l=d.exec(m,l,h);if(l===undefined){l=j}}}if(l===undefined){l=j}return l}if(i==undefined){i=false}if(i===true){setTimeout(e,0)}else{return e()}},exec:function(g,i,f){if(i==undefined){i=[]}if(f==undefined){f=a.scope}if(!(i instanceof Array)){i=[i]}try{return g.apply(f,i)}catch(h){mvc.log.e(h,"Execute event handler",g.toString())}},eventExists:function(g,f){try{var i=a.events[g][f];if(i!=undefined){return true}return false}catch(h){mvc.log.e(h,"Event",g+"->"+f)}return false}};var a={events:{init:{},rendered:{},updated:{},displayed:{}},scope:c||{}};return b});mvc.ext(mvc,"string",{error:{view:{vnun:"View name should not be undefined",vnex:"Cannot set a view as current view that is not existed!"},ajax:{loadErr:"Ajax loading file error"},event:{etnf:"Event type indicated not found."}},info:{view:{ravt:"Trying to render a view that is displaying. Use update method instead.",lpf:"Load Page From:"}}});mvc.ext(mvc.cls,"history",function(){var b={push:function(d){return c.push(d)},clear:function(){return c.clear()},back:function(d){return c.back(d)}};var a={stack:[],};var c={push:function(d){if(d&&d!=null){a.stack.push(d)}},clear:function(d){a.stack=[]},pop:function(){return a.stack.pop()},back:function(d){var e="";if(d===undefined){e=c.pop();while(a.stack.length>0&&(typeof(e)=="undefined"||mvc.util.isEmpty(e)||$("#"+e).length==0)){e=c.pop()}}else{while(a.stack.length>0&&d!=e){e=c.pop()}if(e!=d){e=d}}if(e!=undefined&&e!=null){return e}}};return b});mvc.ext(mvc.cls,"absview",mvc.Class.create({viewMgr:null,name:"undefined",op_buf:"",events:null,initialise:function(a,b){this.name=a;this.viewMgr=b;this.events=new mvc.cls.event(this)},echo:function(a){this.op_buf+=a},show:function(){throw ("Show method should be overwritten.")},fire:function(c,e,b,d){var a;if(this.viewMgr&&this.viewMgr!=null){a=this.viewMgr.events.fire(c,e,b,d,this)}return this.events.fire(c,a,b,d)},getName:function(){return this.name},remove:function(){for(var a in this){if(typeof this[a]=="function"){this[a]=function(){}}else{this[a]=null}}},display:function(){this.fire("displayed",[this,this.viewMgr],undefined,false);return this.op_buf}}));mvc.ext(mvc.cls,"absViewMgr",mvc.Class.create({props:{viewCls:null,curView:null,_views:{}},historyStack:new mvc.cls.history(),initialise:function(a){this.events=new mvc.cls.event();if(a&&typeof a==="object"){for(var b in a){this.props[b]=a[b]}}this.events.bind("displayed","_history_event",function(d,e){var c=e.get();if(c!=null){e.historyStack.push(c.getName())}e.props.curView=d})},get:function(a){if(typeof a=="undefined"){return this.props.curView}if(this.props._views[a]!=undefined){return this.props._views[a]}else{var b=new this.props.viewCls(a);this.props._views[a]=b;return b}},each:function(b){for(var a in this.props._views){b(this.props._views[a])}},isViewExisted:function(a){if(typeof a=="undefined"){mvc.log.e(mvc.string.error.view.vnun,"mvc.view.isViewExisted with parameter:",a);return false}if(this.props._views[a]!=undefined){return true}else{return false}},init:function(a){return this.props._views[a]=new this.props.viewCls(a)},clearHistory:function(){return this.historyStack.clear()},clearAll:function(){this.each(function(a){a.remove()});this.clearHistory();this.props._views={};this.props.curView=null}}));mvc.ext(mvc,"html",{});mvc.ext(mvc,"$",function(a){if(a!=undefined){return $(mvc.opt.appContainer).find(a)}else{return $(mvc.opt.appContainer)}});mvc.ext(mvc.html,"ajax",new (function(){var a={cachedHtml:{}};var c={ajax:function(e,d){var g=e;if(d!==undefined){for(var f in d){g[f]=d[f]}}if(typeof mvc.opt.xhr!="undefined"){g.xhr=mvc.opt.xhr}return $.ajax(g)},asyncLoad:function(f,h,e){function d(i){try{h(i)}catch(j){mvc.log.e(j,"asyncLoad",f)}}if(a.cachedHtml[f]!=undefined){d(a.cachedHtml[f]);return}var g={async:true,url:f,type:"GET",dataType:"text",success:function(i){a.cachedHtml[f]=i;d(i)},error:function(k,j,i){mvc.log.e(j,"asyncLoad",f);d("")}};c.ajax(g,e)},syncLoad:function(j,f){var d=null;if(a.cachedHtml[j]!=undefined){return a.cachedHtml[j]}var k={async:false,url:j,type:"GET",dataType:"text"};try{var h=c.ajax(k,f);if(h.statusText==="error"){mvc.log.e(mvc.string.error.ajax.loadErr,"FilePath",j)}var g="";if(h.responseText){g=h.responseText;a.cachedHtml[j]=g}return g}catch(i){mvc.log.e(mvc.string.error.ajax.loadErr,"FilePath",j);return""}}};var b={syncLoad:c.syncLoad,asyncLoad:c.asyncLoad};return b})());mvc.ext(mvc.html,"view_dom",mvc.Class.create(mvc.cls.absview,{uidata:{},wrapperTag:"div",htmlPagePath:null,loadStatus:"init",initialise:function($super,a){$super(a,mvc.html.domViewMgr)},show:function(){this.load();this.loadDom();this.display(true)},display:function($super,a){var c=this.$();if(c.length==0){this.loadDom(true)}try{if(a===true){func=mvc.opt.interfaces.goBackPage}else{func=mvc.opt.interfaces.goForwPage}func(this.getName());return $super()}catch(b){mvc.log.e(b,"Display View",this.getName())}},load:function(c){if(c===true){this.loadStatus="init";this.op_buf=""}if("loaded"===this.loadStatus){return}if("init"!=this.loadStatus){return}var g="";if(this.htmlPagePath==null){g=mvc.opt.pagePath+"/"+this.getName()+".html"}else{g=this.htmlPagePath}var b=this.getName();this.fire("beforeLoad");mvc.log.i(mvc.string.info.view.lpf+g);var a=mvc.html.ajax.syncLoad(g);var d=mvc.util.copyJSON(this.uidata);var h=d;this.loadStatus="loading";a=this.fire("beforeParse",a,undefined,false);var e=mvc.html.parser.parseHtml(a,h);this.loadStatus="parsing";e=this.fire("afterParse",e,undefined,false);if(this.op_buf!=null&&this.op_buf!=""){e=this.op_buf+e}var f=mvc.util.text.format("<{1} id='{0}' class='{3}'>{4}</{2}>",b,this.wrapperTag,this.wrapperTag,this.viewMgr.getPageCls(),e);this.op_buf=f;this.loadStatus="loaded";this.fire("loaded",{},undefined,false)},loadDom:function(a){if(a==undefined){a=false}if(this.loadStatus!="loaded"){this.removeDom();this.load(true)}if(this.loadStatus==="loaded"){if(mvc.$("#"+this.getName()).length===0||a===true){mvc.$().append(this.op_buf);this.fire("domReady",this.$(),undefined,false)}return}else{mvc.log.e("Cannot load view properly.","view name:",this.getName())}},removeDom:function(){mvc.$("#"+this.name).remove()},$:function(a){if(typeof a!="undefined"){return mvc.$("#"+this.name).find(a)}return mvc.$("#"+this.name)},remove:function($super){this.removeDom();$super()},setDomEvent:function(a){var b=this;function c(){for(var d in a){for(var e in a[d]){b.$(d).unbind(e);b.$(d).bind(e,a[d][e])}}}if(this.$().length===0){this.events.bind("domReady","_setDomEvents",function(){this.events.unbind("domReady","_setDomEvents");c()})}else{c()}}}));mvc.ext(mvc.html,"_domViewMgr",mvc.Class.create(mvc.cls.absViewMgr,new (function(){var b={back:function(){var d=this.historyStack.back();if(d!=undefined){this.get(d).display(false)}return d},preLoad:function(e,f,d){return c.preLoad(e,f,d)},preLoadAll:function(f,d){var g=0;for(var e in a._views){g++}this.each(function(h){if(f===false){h.loadDom()}else{setTimeout(function(){h.loadDom();g--;if(g===0){if(d&&typeof d==="function"){d()}}},1)}})},setPageCls:function(d){return c.setPageCls(d)},getPageCls:function(){return c.getPageCls()},initialise:function($super){this.props.viewCls=mvc.html.view_dom;$super(a)}};var a={pageCls:"page"};var c={preLoad:function(f,h,d){var j=f.length;for(var g=0;g<f.length;g++){var e=f[g];if(h===false){e.loadDom()}else{(function(){var i=e;setTimeout(function(){i.loadDom();j--;if(j===0){if(d&&typeof d==="function"){d()}}},1)})()}}},getPageCls:function(){return a.pageCls},setPageCls:function(d){a.pageCl=d;return d}};return b})()));mvc.html.domViewMgr=new mvc.html._domViewMgr();mvc.ext(mvc.html,"parser",new (function(){var b={parseHtml:function(d,e){return c.parseHtml(d,e)},addScopeItem:function(d,e){if(d&&e){a._basic[d]=e}},removeScopeItem:function(d){if(d&&a._basic[d]){delete a._basic[d]}}};var a={startTag:"<?mvc",endTag:"?>",_basic:{__resStack:"",echo:function(d){this.__resStack+=d}}};var c={parseHtml:function(g,f){var e=-1;if(f==undefined||mvc.util.isEmpty(f)){f={}}mvc.util.copyJSON(a._basic,f);if(g==undefined){return""}var l=a.startTag;var k=a.endTag;while((e=g.indexOf(l))!=-1){f.__resStack="";var i=e+l.length+1;var h=g.indexOf(k,i);var j=g.substring(i,h);var d="";d=mvc.html.parseExec(j,f);if(d==undefined){d=""}d=f.__resStack+d;g=g.replace(g.substring(e,h+2),d)}return g}};return b})());mvc.ext(mvc.html,"parseExec",function(__code__,__scope__){with(__scope__){try{return eval(__code__)}catch(e){mvc.log.e(e,"Parse MVC code:",__code__)}}});mvc.ext(mvc.html,"parseJSON",function(__code__){try{return eval("("+__code__+")")}catch(e){mvc.log.e(e,"Parse JSON Object:",__code__)}});mvc.ext(mvc.html,"element",function(){try{if(mvc.html.parser==undefined){throw ("MVC HTML parser is not ready")}}catch(b){mvc.log.e(b)}function a(c,f){if(f==undefined){f={}}var e=mvc.opt.elementPath+"/"+c+".html";var d=mvc.html.ajax.syncLoad(e);d=mvc.html.parser.parseHtml(d,f);return d}mvc.html.parser.removeScopeItem("element");mvc.html.parser.addScopeItem("element",a)});mvc.html.element();